name: Verify

on:
  push:
    branches: [ "*" ]

jobs:
  build-backend:
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repository
        uses: actions/checkout@v5
      - name: Set up JDK 21
        uses: actions/setup-java@v5
        with:
          java-version: '21'
          distribution: "zulu"
      - name: Verify package
        run: mvn clean verify
        working-directory: backend

  build-frontend:
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repository
        uses: actions/checkout@v5
      - name: Set up pnpm
        uses: pnpm/action-setup@v4
        with:
          version: '10'
      - name: Set up node
        uses: actions/setup-node@v4
        with:
          version: '22'
      - name: üèó Setup Expo and EAS
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
        working-directory: frontend/lifeblood-mobile
      - name: Replace google-services # necessary for build to pass
        run: mv example-google-services.json google-services.json
        working-directory: frontend/lifeblood-mobile
      - name: Generate open-api
        run: pnpm run gen-open-api
      - name: Run TypeScript type check
        run: pnpm tsc --noEmit
        working-directory: frontend/lifeblood-mobile
      - name: Prebuild App
        run: npx expo prebuild --platform android
        working-directory: frontend/lifeblood-mobile